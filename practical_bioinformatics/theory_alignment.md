# Конспект: Парное и множественное выравнивание в биоинформатике

## 1. Основные понятия

**Зачем выравнивание?**
Обнаружение подобных последовательностей -> эволюционные отношения -> связанная функция

**Гомологи:**
- **Ортологи** (одна и та же функция но разные организмы)
- **Паралоги** (разные в одном организме в результате дупликации)

**Гомология** – происхождение от общего предка (выравнивание отражает гомологичные участки генома или белков)

*Конвергенции на уровне последовательности белков почти не бывает, только на очень коротких участках, но точно не на всей длине последовательности*

## 2. Парное выравнивание

### Глобальное выравнивание
- Даны последовательности разной длины
- Пришлось вставить гэпы
- Гэпы показывают, что для данного аминокислотного остатка нет гомологичного в том же белке.

**Причины гэпов:**
- Биологические (инсерции/делеции, закрепившиеся в эволюции или последовательности гомологичны не по всей длине)
- Технические

**Для выравнивания:** emboss

**Глобальное выравнивание:** выравнивает последовательности по всей длине и расставляет гэпы

**Используем**, если уверены, что все последовательности гомологичны по всей длине

### Локальное выравнивание
**А если у этих белков есть общие гомологичные участки, но нельзя сказать, что они гомологичны по всей длине?**

- Выбирает в каждой последовательности по участку и выравнивает между собой эти участки
- Используем ЛВ, если две последовательности содержат небольшие гомологичные участки или если мы ничего не знаем о последовательности заранее

**Алгоритмы:**
- Глобальное выравнивание: алгоритм Нидмана-Вунша
- Локальное выравнивание: алгоритм Смитта-Ватермана

Оба алгоритма работают так, чтобы *максимизировать вес оптимального выравнивания*

### Сравнение алгоритмов

| Параметр | Глобальное Выравнивание (Needleman-Wunsch) | Локальное Выравнивание (Smith-Waterman) |
|----------|---------------------------------------------|------------------------------------------|
| **Цель** | Сравнить последовательности по всей длине | Найти наиболее похожие регионы |
| **Вес** | Как правило, больше (если последовательности схожи по длине и глобально гомологичны) | Как правило, меньше, но может быть выше плотность совпадений в найденном регионе |
| **Когда вес будет выше?** | Когда сравниваются гомологичные белки/гены схожей длины и структуры (например, гемоглобины человека и шимпанзе) | Когда сравниваются белки/гены с одним консервативным доменом, но разной общей структурой (например, если у белков есть общий каталитический домен, но разные регуляторные) |
| **Обработка концов** | Штрафует несовпадения на концах так же, как и в середине | Игнорирует непохожие концы, фокусируясь только на внутренних похожих регионах |

## 3. Формальная задача и матрицы весов

**Формальная задача:** вес должен быть тем больше, чем больше выравнивание похоже на правильное (отражающее эволюцию)

**В настоящее время устоялся следующий подход:**
- Для последовательностей ДНК за каждую пару совпадающих букв к весу выравнивания прибавляется некоторое число, а за каждую пару разных букв вычитается другое число
- Для последовательностей белков есть понятие веса замены букв: чем реже буквы заменяются друг на друга в эволюции, тем меньше этот вес. Всего 210 чисел, некоторые из них положительные, другие отрицательные. Они составляют матрицу весов аминокислотных замен
- За гэпы вычитается штраф (gap penalty)

**Матрицы весов аминокислотных замен:** BLOSUM62
BLOSUM62 построена с использованием последовательностей, которые идентичны менее чем на 62%

## 4. Алгоритм BLAST

**BLAST** (Basic Local Alignment Search Tool)

**Что есть на вход:** последовательность белка
**Что надо сделать:** необходимо получить список белков гомологичных заданному
**Где ищем:** банк последовательностей (кастомный, Uniprot и т.д.)
**Кого берём:** последовательности, сходство которых выше заранее заданного порога

```
[ Ваш запрос MQIFVKTLTG ] --> Разбить на слова [MQI, QIF, IFV...]
|
| Для каждого слова
|
Найти в БД похожие слова (с баллом > T)
|
| Найти две зацепки
| на одной диагонали
|
Расширить без щелей --> Отбросить, если балл < X
|
Расширить со щелями (полное локальное выравнивание)
|
Оценить значимость (E-value, Bit Score)
|
[ ВЫВОД: Список выровненных последовательностей ]
```


### Этапы работы BLAST:

**Этап 1: Подготовка запроса**
- Ввод последовательности-запроса (белковой или нуклеотидной)
- Задание параметров: Определяется размер "слова" (word size, например, 3 для белков)
- Маскация (опционально): Повторяющиеся или малоинформативные регионы запроса "маскируются", чтобы исключить их из поиска и уменьшить шум

**Этап 2: Генерация и поиск "слов-зацепок" (Hit Generation)**
- Разбиение запроса на "слова": Последовательность-запрос разбивается на все возможные перекрывающиеся короткие фрагменты (k-меры) заданной длины
- Пример для белка MQIFV... при word size=3: MQI, QIF, IFV, ...
- Поиск похожих слов в базе данных: Для каждого слова из запроса в предварительно проиндексированной базе данных находятся все похожие слова, а не только идентичные
- Фильтрация по порогу: Отбираются только те пары слов, балл схожести которых (рассчитанный с помощью матрицы замен, например, BLOSUM62) превышает пороговое значение T. Каждая такая пара считается "зацепкой" (hit)

**Этап 3: Расширение зацепок**
- Поиск двух зацепок на одной диагонали (Two-Hit Method): Алгоритм ищет две неперекрывающиеся зацепки, лежащие на одной диагональной линии в матрице сравнения запроса и последовательности из базы. Это указывает на потенциальный регион сходства без сдвигов
- Беcщелевое расширение (Ungapped Extension): Для таких пар зацепок выравнивание расширяется в обе стороны вдоль диагонали без вставки щелей (gaps)
- Проверка значимости расширения: Если балл полученного беcщелевого выравнивания превышает порог X, эта область считается "семенем" (seed) для следующего, более тщательного этапа

**Этап 4: Точное выравнивание**
- Расширение со щелями (Gapped Extension): Для всех перспективных "семян" выполняется полноценный алгоритм локального выравнивания (аналогичный Смиту-Ватерману), который допускает вставку щелей. В результате строится HSB (High-Scoring Segment Pair) — лучшее локальное выравнивание для данного региона

**Этап 5: Оценка значимости и вывод результатов**
- Статистическая оценка: Для каждого найденного HSB вычисляются:
  - **Bit Score (S')**: Нормализованный балл, показывающий качество выравнивания
  - **E-value (Expect Value)**: Ожидаемое число случайных совпадений с таким же или лучшим баллом в базе данного размера. Чем E-value меньше, тем значимее результат

### Пример работы BLAST:

**Входная последовательность:** ALGFMK
**Параметры** Длина слова: W = 3
**Вес выравнивания**, достаточный, чтобы считать два слова похожими: T = 12

1. Разобьем входную последовательность на слова длины W: ALG LGF GFM FMK
2. Добавим в список похожие слова (см. Т)
3. Составим список индексов вхождения слов в банке, похожих на полученные слова
4. Расширим выравнивания со словами в банке до максимального суммарного веса

**e-value** – это мат ожидание числа находок с таким же или большим весом выравнивания в банке случайных последовательностей того же размера как тот банк, в котором вёлся поиск

## 5. Экспериментальные методы

**Метод Эдмана:** обработка исследуемого пептида определенным набором реагентов, что приводит к расщеплению одной аминокислоты с N-конца последовательности

**Illumina**
- **Иммобилизация:** Библиотека фрагментов с адаптерами наносится на проточную ячейку (flow cell), внутренняя поверхность которой покрыта "праймерами", комплементарными адаптерам
- **Мостовая ПЦР (Bridge Amplification):** Каждый фрагмент гибридизуется с праймером на ячейке и с помощью ПЦР многократно копируется на одном месте. В результате вокруг каждой исходной молекулы образуется кластер (~1000 идентичных копий ДНК)
- **Этап 3: Секвенирование синтезом (Sequencing by Synthesis)**
  - Денатурация и прайминг: Двойные цепи в кластерах разделяются, и к ним присоединяется секвенирующий праймер
  - Циклический синтез: В ячейку поочередно подаются все 4 типа флуоресцентно-меченных нуклеотидов (A, T, G, C)
  - К растущей цепи ДНК добавляется только один комплементарный нуклеотид
  - Неприсоединившиеся нуклеотиды смываются
  - Детекция: Лазер возбуждает флуоресцентную метку, и камера делает снимок всей ячейки. По цвету свечения определяется, какой нуклеотид добавился в каждом кластере
  - Снятие метки: Флуоресцентная метка химически "срезается", что позволяет добавить следующий нуклеотид
  - Преобразование сигналов: Компьютер преобразует последовательность цветных сигналов из каждого кластера в последовательность нуклеотидов. Для каждого фрагмента получается рид (read)

## 6. Множественное выравнивание (MSA)

**Зачем нужно MSA?**
- Обнаружение удалённой гомологии
- Выявление консервативных остатков и функциональных мотивов
- Построение филогенетических деревьев

**Почему MSA — сложная задача?**
- Прямой поиск глобального оптимума требует построения N-мерной матрицы
- Сложность растёт экспоненциально с увеличением числа последовательностей: O(2L^N)
- Определение веса MSA

### Подходы к построению MSA

**1. Прогрессивное выравнивание**
- Начинается с парных выравниваний
- Строится "guide tree" (UPGMA, Neighbor-Joining)
- Последовательности объединяются шаг за шагом согласно дереву
- **Недостаток:** ошибки на ранних этапах не исправляются
- **Примеры:** ClustalW/Omega, MAFFT, MUSCLE, T-Coffee

**2. Итеративные методы**
- Многократное пересчитывание и улучшение выравнивания
- **Пример:** ProbCons

**3. Локальное блочное выравнивание**
- **Пример:** DiAlign

**4. HMM-подходы (скрытые марковские модели)**
- **Примеры:** SAM, HHalign, hmmalign (HMMER)

**5. Консенсусные методы**
- Комбинирование результатов нескольких методов
- **Пример:** T-Coffee (M-Coffee), MergeAlign

### Сравнение программ для MSA

| Программа | Алгоритм | Особенности | Когда использовать |
|-----------|----------|-------------|-------------------|
| T-Coffee | Consistency-based | Высокая точность, можно интегрировать другие выравнивания | Малые наборы, низкая идентичность, нужна точность |
| ProbCons | HMM + consistency | Очень точный, но медленный | Высокая точность, умеренное число последовательностей |
| MUSCLE | Прогрессивный + итеративный | Баланс скорости и качества | Большие наборы, нужна скорость |
| MAFFT | FFT-ускоренный | Гибкость: от быстрого до точного режимов | Универсально, от малых до огромных данных |
| ClustalW | Прогрессивный (UPGMA/NJ) | Исторический стандарт | Учебные задачи, простые наборы |
| Clustal Omega | Профиль-HMM + k-mer tree | Лучшая масштабируемость | Большие выравнивания |

### Рекомендации по работе с MSA

**Выбор инструмента зависит от цели:**
- Мало последовательностей + точность → T-Coffee, ProbCons, MAFFT L-INS-i
- Сотни/тысячи последовательностей → MAFFT FFT-NS, MUSCLE, Clustal Omega

**Контроль качества:**
- Консервативные мотивы должны выравниваться
- Использование тестовых баз (например, BAliBASE)

**Эволюционная правдоподобность:**
- Построение филогенетического дерева для проверки клад
- Использование структурной информации, если есть 3D-структура

**Дополнительные шаги:**
- Сравнение результатов разных программ
- Удаление малодостоверных участков (Gblocks, TrimAl)

## 7. Введение в филогенетику

**Что такое филогенетическое дерево?** Диаграмма, отражающая эволюционные связи между таксонами. Это гипотеза о родстве через общих предков

**Филогенетические деревья помогают:**
- Определять эволюционное родство между видами
- Анализировать происхождение и эволюцию генов
- Прослеживать эволюционные пути патогенов

### Основные элементы дерева:
- **Корень** – общий предок всех таксонов
- **Ветви** – путь эволюционного развития
- **Узлы** – точки дивергенции (разделения линий)
- **Листья** – современные таксоны

### Типы деревьев:
- **Кладограмма** – показывает только порядок ветвления
- **Филограмма** – длины ветвей пропорциональны эволюционному расстоянию

**Длины ветвей могут означать:**
- Время, прошедшее между последовательностями
- Число мутаций

**Филогенетика** — это раздел биологии, изучающий эволюционные связи между организмами. Она исследует происхождение и развитие различных видов, их общее эволюционное прошлое, и создает гипотезы о том, как они связаны между собой на основе:
- Морфологических данных (внешние признаки и структуры)
- Молекулярных данных (сравнение ДНК, РНК и белков)

### Методы построения деревьев
**UPGMA:**
- Предполагает гипотезу молекулярных часов (постоянная скорость эволюции)
- Строит ультраметрическое дерево (все листья на одинаковом расстоянии от корня)

**Оценка эволюционных расстояний:**
- p-distance
- Коррекция моделей замен: учет множественных замен в одном сайте, использование марковских моделей эволюции (матрица Q)

### Эволюционные модели
- **Для аминокислот:** эмпирические матрицы замен (BLOSUM62, LG, JTT, WAG)
- **Для нуклеотидов:** модели с коррекцией (например, K80, HKY, GTR)

**Обработка гэпов в выравниваниях**
- Трактовать гэп как отдельный символ
- Игнорировать гэпы (удалять колонки или не учитывать в попарных сравнениях)

## 8. Коррекция расчета расстояния

### Основная проблема
**Что мы видим (Наблюдения):** Сравнивая две последовательности (например, человека и мыши), мы видим, что в некоторых позициях нуклеотиды совпадают, а в каких-то — различаются. Количество различий — это "сырое" расстояние

**Почему это плохое расстояние:** "Сырое" расстояние — ненадежный показатель по двум причинам:

1. **Множественные замены (Multiple Hits):** В одной и той же позиции за долгое время могло произойти несколько замен. Например, A → T → G. Мы увидим лишь различие A/G, не зная о промежуточной стадии T. Таким образом, мы недооцениваем истинное число случившихся замен

2. **Обратные замены (Back Substitutions):** В позиции могла произойти замена A → C, а потом обратно C → A. Мы вообще не увидим никакого различия, хотя две замены произошли

**Вывод:** Наблюдаемое количество различий — это лишь видимая часть айсберга. Истинное число замен всегда больше или равно наблюдаемому

### Цель коррекции
Нам нужно эволюционное расстояние, которое:

- **Аддитивно:** Если расстояние от вида A к виду B равно d1, а от B к C — d2, то расстояние от A к C должно быть примерно d1 + d2. С "сырым" расстоянием это не работает из-за множественных замен

- **Линейно зависит от времени:** Если скорость эволюции постоянна, то расстояние должно быть прямо пропорционально времени дивергенции. Это позволило бы использовать его как "молекулярные часы"

Такое идеальное расстояние — это среднее число замен на сайт (d), которое действительно произошло за время эволюции. Именно его мы и хотим оценить

### Решение: Вероятностная модель (Марковская цепь)
Поскольку мы не можем прямо наблюдать все исторические замены, мы строим модель того, как они происходят

**Модель как Марковский процесс:** Эволюция каждого сайта (нуклеотида) представляется как цепь Маркова. Это значит, что состояние сайта в следующий момент времени зависит только от его текущего состояния (и не зависит от того, что было раньше). Это разумное упрощение для эволюции

**Матрица скоростей (Q):** Это сердце модели. Она описывает, с какой скоростью один нуклеотид превращается в другой

- Диагональные элементы (например, -μ_A) показывают общую скорость ухода из состояния A. Сумма скоростей ухода равна общей скорости замен μ
- Недиагональные элементы (например, μ_AC) показывают скорость перехода из A в C

Матрица Q в тексте — это пример для 4-х состояний (A, C, G, T). Конкретные значения элементов μ задаются моделью замен (например, моделью Джукса-Кантора, Кимуры и т.д.)

**Матрица вероятностей переходов (P(t)):** Это то, что мы хотим получить. Элемент P_ij(t) этой матрицы показывает вероятность того, что нуклеотид i через время t станет нуклеотидом j

**Ключевое уравнение:** P(t) = exp(Q×t)

Матричная экспонента exp(Q×t) — это математический способ рассчитать вероятности переходов за время t, учитывая все возможные пути (включая множественные и обратные замены!), которые не видны при простом сравнении
